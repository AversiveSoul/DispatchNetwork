<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SDN AGENT NETWORK - TACTICAL DATABASE</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Architects+Daughter&family=Inter:wght@400;700&family=Outfit:wght@700&family=Share+Tech+Mono&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        --teal: #1e5655;
        --neon-green: #46fa5b;
        --bg-dark: #0f1716;
        --card-dark: #1a2423;
        --input-dark: #0a0f0e;
        --text-main: #e2e8f0;
      }
      body {
        font-family: "Inter", sans-serif;
        background-color: var(--bg-dark);
        color: var(--text-main);
        overflow-x: hidden;
      }
      .font-mono-tactical {
        font-family: "Share+Tech+Mono", monospace;
      }
      .font-display {
        font-family: "Outfit", sans-serif;
      }
      .paper-card {
        background: var(--card-dark);
        border-radius: 8px;
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.4);
        border: 1px solid rgba(70, 250, 91, 0.1);
      }
      .input-clean {
        background: var(--input-dark);
        border: 1px solid rgba(70, 250, 91, 0.2);
        border-radius: 4px;
        padding: 4px 8px;
        width: 100%;
        outline: none;
        color: white;
      }
      .input-clean:focus {
        border-color: var(--neon-green);
      }
      .stat-box {
        border: 2px solid var(--teal);
        border-radius: 8px;
        padding: 5px;
        background: var(--input-dark);
      }
      .custom-scrollbar::-webkit-scrollbar {
        width: 4px;
      }
      .custom-scrollbar::-webkit-scrollbar-track {
        background: var(--bg-dark);
      }
      .custom-scrollbar::-webkit-scrollbar-thumb {
        background: var(--teal);
        border-radius: 10px;
      }
    </style>
  </head>
  <body>
    <div id="root"></div>

    <script type="text/babel">
      const { useState, useEffect } = React;

      const DEFAULT_SHEET = {
        id: Date.now(),
        heroName: "Novo Agente",
        playerName: "",
        ageProf: "",
        summary: "",
        attrCombat: 0,
        attrIntelligence: 0,
        attrCharisma: 0,
        attrMobility: 0,
        attrVigor: 0,
        powers: "",
        weaknesses: "",
        goal: "",
        gear: "",
        activeOps: "",
        repSdn: 50,
        repMedia: 50,
        repCivis: 50,
        portraitFilename: "",
      };

      function App() {
        const [sheets, setSheets] = useState([]);
        const [activeId, setActiveId] = useState(null);
        const [loading, setLoading] = useState(true);
        const [status, setStatus] = useState("OFFLINE");

        // --- CARGA AUTOM√ÅTICA (IGUAL AO MAPA) ---
        const loadAgents = async () => {
          setLoading(true);
          setStatus("SINCRONIZANDO...");
          const timestamp = new Date().getTime();

          try {
            const response = await fetch(`./agentes.json?v=${timestamp}`);
            if (!response.ok) throw new Error("Erro ao ler banco de dados");

            const data = await response.json();
            setSheets(data);
            if (data.length > 0) setActiveId(data[0].id);

            setStatus("ONLINE");
          } catch (err) {
            console.error("Falha ao carregar:", err);
            setStatus("ERRO DE CONEX√ÉO");
          } finally {
            setLoading(false);
          }
        };

        useEffect(() => {
          loadAgents();
        }, []);

        const activeSheet =
          sheets.find((s) => s.id === activeId) ||
          (sheets.length > 0 ? sheets[0] : DEFAULT_SHEET);

        const updateField = (field, value) => {
          setSheets((prev) =>
            prev.map((s) => (s.id === activeId ? { ...s, [field]: value } : s))
          );
        };

        const downloadJSON = () => {
          const dataStr =
            "data:text/json;charset=utf-8," +
            encodeURIComponent(JSON.stringify(sheets, null, 2));
          const downloadAnchorNode = document.createElement("a");
          downloadAnchorNode.setAttribute("href", dataStr);
          downloadAnchorNode.setAttribute("download", "agentes.json");
          document.body.appendChild(downloadAnchorNode);
          downloadAnchorNode.click();
          downloadAnchorNode.remove();
        };

        if (loading) {
    return (
        <div className="h-screen flex items-center justify-center bg-black font-mono-tactical text-[#46fa5b]">
            <div className="animate-pulse">
                &gt; ACESSANDO ARQUIVOS DE INTELIG√äNCIA...
            </div>
        </div>
    );
}

        return (
          <div className="min-h-screen pb-20">
            <header className="bg-[#1a2c2b] text-white p-4 shadow-lg border-b-4 border-[#46fa5b]">
              <div className="max-w-6xl mx-auto flex flex-col md:flex-row justify-between items-center gap-4">
                <div className="flex items-center gap-8">
                  <div>
                    <h1 className="font-display text-2xl font-bold tracking-tighter text-[#46fa5b]">
                      SDN AGENT NETWORK
                    </h1>
                    <p className="text-[10px] font-mono-tactical text-[#46fa5b] opacity-70">
                      STATUS: {status}
                    </p>
                  </div>
                </div>

                <div className="flex gap-3 items-center">
                  {/* BOT√ÉO PARA VOLTAR PARA O MAPA */}
                  <a
                    href="missions.html"
                    className="bg-red-900/40 border border-red-500 text-red-500 px-3 py-2 rounded text-[10px] font-bold hover:bg-red-500 hover:text-white transition-all"
                  >
                    VOLTAR AO MAPA
                  </a>

                  <select
                    className="bg-black/60 border border-[#46fa5b]/30 rounded px-3 py-1 text-sm outline-none text-white font-mono-tactical"
                    value={activeId || ""}
                    onChange={(e) => setActiveId(Number(e.target.value))}
                  >
                    {sheets.map((s) => (
                      <option key={s.id} value={s.id}>
                        {s.heroName}
                      </option>
                    ))}
                  </select>
                  <button
                    onClick={() => {
                      const newS = { ...DEFAULT_SHEET, id: Date.now() };
                      setSheets([...sheets, newS]);
                      setActiveId(newS.id);
                    }}
                    className="bg-[#46fa5b] text-[#0f1716] px-4 py-2 rounded font-bold text-xs hover:bg-white transition-colors"
                  >
                    + NOVO AGENTE
                  </button>
                </div>
              </div>
            </header>

            <main className="max-w-6xl mx-auto p-4 grid grid-cols-1 lg:grid-cols-12 gap-6 mt-4">
              <div className="lg:col-span-5 space-y-4">
                <section className="paper-card p-4">
                  <div className="flex gap-4">
                    <div className="w-1/3 text-center">
                      <div className="aspect-[3/4] bg-[#0a0f0e] rounded border-2 border-[#2b7a78]/40 overflow-hidden relative group">
                        <img
                          src={`./FotosDosAgentes/${activeSheet.portraitFilename}`}
                          className="w-full h-full object-cover grayscale hover:grayscale-0 transition-all"
                          onError={(e) => {
                            e.target.src =
                              "https://via.placeholder.com/150?text=SEM+FOTO";
                          }}
                        />
                      </div>
                      <input
                        className="input-clean mt-2 text-[9px] font-mono-tactical"
                        placeholder="nome_da_foto.jpg"
                        value={activeSheet.portraitFilename || ""}
                        onChange={(e) =>
                          updateField("portraitFilename", e.target.value)
                        }
                      />
                    </div>
                    <div className="flex-1 space-y-2">
                      <label className="text-[9px] font-bold text-[#46fa5b] opacity-60 uppercase tracking-widest">
                        Codinome Operacional
                      </label>
                      <input
                        className="input-clean font-display text-xl font-bold text-[#46fa5b]"
                        value={activeSheet.heroName}
                        onChange={(e) =>
                          updateField("heroName", e.target.value)
                        }
                      />
                      <label className="text-[9px] font-bold text-[#46fa5b] opacity-60 uppercase tracking-widest block pt-2">
                        Identidade Real / Civil
                      </label>
                      <input
                        className="input-clean text-sm"
                        value={activeSheet.ageProf}
                        onChange={(e) => updateField("ageProf", e.target.value)}
                      />
                    </div>
                  </div>
                </section>

                <section className="paper-card p-4 font-mono-tactical">
                  <h2 className="text-[#46fa5b] font-bold text-[10px] uppercase mb-3 tracking-widest border-b border-[#46fa5b]/20 pb-1">
                    N√≠veis de Reputa√ß√£o
                  </h2>
                  <div className="space-y-3">
                    <div>
                      <label className="text-[9px] text-slate-400 uppercase flex justify-between">
                        Conex√£o SDN <span>{activeSheet.repSdn}%</span>
                      </label>
                      <input
                        type="range"
                        className="w-full accent-[#46fa5b]"
                        value={activeSheet.repSdn}
                        onChange={(e) => updateField("repSdn", e.target.value)}
                      />
                    </div>
                    <div>
                      <label className="text-[9px] text-slate-400 uppercase flex justify-between">
                        Status na M√≠dia <span>{activeSheet.repMedia}%</span>
                      </label>
                      <input
                        type="range"
                        className="w-full accent-blue-400"
                        value={activeSheet.repMedia}
                        onChange={(e) =>
                          updateField("repMedia", e.target.value)
                        }
                      />
                    </div>
                    <div>
                      <label className="text-[9px] text-slate-400 uppercase flex justify-between">
                        Apoio Civil <span>{activeSheet.repCivis}%</span>
                      </label>
                      <input
                        type="range"
                        className="w-full accent-orange-400"
                        value={activeSheet.repCivis}
                        onChange={(e) =>
                          updateField("repCivis", e.target.value)
                        }
                      />
                    </div>
                  </div>
                </section>

                <section className="paper-card p-4">
                  <h2 className="text-[#46fa5b] font-bold text-[10px] uppercase mb-3 tracking-widest border-b border-[#46fa5b]/20 pb-1 font-mono-tactical">
                    Atributos T√°ticos
                  </h2>
                  <div className="grid grid-cols-5 gap-2">
                    {[
                      { n: "Combate", l: "Combate" },
                      { n: "Inteligencia", l: "Inteligencia" },
                      { n: "Carisma", l: "Carisma" },
                      { n: "Mobilidade", l: "Mobilidade" },
                      { n: "Vigor", l: "Vigor" },
                    ].map((attr) => {
                      const fieldName = `attr${attr.n}`;
                      return (
                        <div key={attr.n} className="text-center">
                          <div className="stat-box">
                            <input
                              type="number"
                              className="w-full text-center font-bold text-xl outline-none bg-transparent text-white"
                              value={activeSheet[fieldName] || 0}
                              onChange={(e) =>
                                updateField(fieldName, e.target.value)
                              }
                            />
                          </div>
                          <span className="text-[7px] font-bold uppercase text-slate-500 block mt-1 font-mono-tactical">
                            {attr.l}
                          </span>
                        </div>
                      );
                    })}
                  </div>
                </section>
              </div>

              <div className="lg:col-span-7 space-y-4 flex flex-col">
                <section className="paper-card p-4 flex-1">
                  <h2 className="font-bold text-[#46fa5b] uppercase text-[10px] tracking-widest mb-2 flex items-center gap-2 font-mono-tactical">
                    üìÅ Hist√≥rico e Informa√ß√µes
                  </h2>
                  <textarea
                    className="w-full h-48 bg-transparent border-none outline-none font-mono-tactical text-xs leading-relaxed text-[#46fa5b]/80 resize-none custom-scrollbar p-2 bg-black/20 rounded"
                    value={activeSheet.activeOps || ""}
                    onChange={(e) => updateField("activeOps", e.target.value)}
                    placeholder="Aguardando inser√ß√£o de logs..."
                  />

                  <div className="grid grid-cols-2 gap-4 mt-4 border-t border-white/5 pt-4">
                    <div>
                      <h3 className="text-[9px] font-bold text-[#46fa5b] uppercase mb-1 font-mono-tactical">
                        Capacidades Especiais
                      </h3>
                      <textarea
                        className="input-clean text-xs h-24 resize-none"
                        value={activeSheet.powers || ""}
                        onChange={(e) => updateField("powers", e.target.value)}
                      />
                    </div>
                    <div>
                      <h3 className="text-[9px] font-bold text-red-400 uppercase mb-1 font-mono-tactical">
                        Pontos Cr√≠ticos (Fraquezas)
                      </h3>
                      <textarea
                        className="input-clean text-xs h-24 resize-none"
                        value={activeSheet.weaknesses || ""}
                        onChange={(e) =>
                          updateField("weaknesses", e.target.value)
                        }
                      />
                    </div>
                  </div>
                  <div className="mt-6 pt-4 border-t border-white/5 flex justify-between items-center">
                    <span className="text-[8px] text-slate-600 font-mono-tactical tracking-tighter">
                      UID: {activeSheet.id}
                    </span>
                    <button
                      onClick={() => {
                        if (
                          sheets.length > 1 &&
                          confirm(
                            `Confirmar encerramento de contrato do agente ${activeSheet.heroName}?`
                          )
                        ) {
                          const newSheets = sheets.filter(
                            (s) => s.id !== activeId
                          );
                          setSheets(newSheets);
                          setActiveId(newSheets[0].id);
                        }
                      }}
                      className="text-[9px] text-red-800 hover:text-red-500 uppercase font-bold font-mono-tactical transition-colors"
                    >
                      [ ELIMINAR REGISTRO ]
                    </button>
                  </div>
                </section>
              </div>
            </main>
          </div>
        );
      }

      const root = ReactDOM.createRoot(document.getElementById("root"));
      root.render(<App />);
    </script>
  </body>
</html>
