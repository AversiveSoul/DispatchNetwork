<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SHADOWNET</title>
    <script>
        (function() {
            const isAuthenticated = sessionStorage.getItem('sdn_auth');
            if (isAuthenticated !== 'true') {
                window.location.href = "../index.html";
            }
        })();
    </script>
    <script>
        (function() {
            const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) 
                             || (window.innerWidth <= 800);
            if (isMobile) {
                window.location.href = "no-mobile.html";
            }
        })();
    </script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&family=Inter:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --dark-bg: #050505;
            --hacker-green: #00ff41;
            --border-color: #1a1a1a;
            --danger-red: #ff003c;
            --neon-red: #ff0000;
        }
        body {
            background-color: var(--dark-bg);
            color: #e2e8f0;
            font-family: 'Inter', sans-serif;
            overflow-x: hidden;
        }
        .mono { font-family: 'Share Tech Mono', monospace; }
        .scanlines::after {
            content: " ";
            display: block;
            position: fixed;
            top: 0; left: 0; bottom: 0; right: 0;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.1) 50%), 
                        linear-gradient(90deg, rgba(255, 0, 0, 0.02), rgba(0, 255, 0, 0.01), rgba(0, 255, 0, 0.02));
            z-index: 999;
            background-size: 100% 4px, 3px 100%;
            pointer-events: none;
        }
        .glitch-hover:hover {
            text-shadow: 2px 0 var(--danger-red), -2px 0 var(--hacker-green);
        }
        .post-card {
            border-bottom: 1px solid var(--border-color);
            transition: all 0.3s ease;
        }
        .post-card:hover {
            background-color: rgba(255, 255, 255, 0.03);
            border-left: 2px solid var(--hacker-green);
        }
        .security-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.95);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        .profile-header {
            background-size: cover;
            background-position: center;
            height: 200px;
            position: relative;
        }
        .neon-user-name {
            color: var(--neon-red);
            text-shadow: 0 0 5px rgba(255, 0, 0, 0.7), 0 0 10px rgba(255, 0, 0, 0.5);
            transition: text-shadow 0.3s ease;
        }
        .neon-user-name:hover {
            text-shadow: 0 0 8px rgba(255, 0, 0, 0.9), 0 0 15px rgba(255, 0, 0, 0.7);
        }
        .reply-card {
            border-left: 2px solid #333;
            margin-left: 3rem;
            margin-top: 0.5rem;
            background: rgba(255, 255, 255, 0.01);
        }
    </style>
</head>
<body class="scanlines">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const App = () => {
            const [profiles, setProfiles] = useState([]);
            const [posts, setPosts] = useState([]);
            const [loading, setLoading] = useState(true);
            const [securityGuard, setSecurityGuard] = useState(null);
            const [isBlocked, setIsBlocked] = useState(false);
            const [currentView, setCurrentView] = useState('feed');
            const [selectedUser, setSelectedUser] = useState(null);
            const [usuarioAtivo, setUsuarioAtivo] = useState({ heroName: "Desconhecido", portraitFilename: "default.jpg" });

            const fetchData = async () => {
                try {
                    const [resPerfis, resPosts] = await Promise.all([
                        fetch('./perfis.json?v=' + Date.now()),
                        fetch('./posts.json?v=' + Date.now())
                    ]);

                    const dataPerfis = await resPerfis.json();
                    let dataPosts = await resPosts.json();

                    dataPosts.sort((a, b) => {
                        const converterData = (dataStr) => {
                            const [dia, mes, ano] = dataStr.split('/');
                            return new Date(ano, mes - 1, dia);
                        };
                        return converterData(b.createdAt) - converterData(a.createdAt);
                    });

                    setProfiles(dataPerfis);
                    setPosts(dataPosts);

                    setSecurityGuard({
                        id: 909538,
                        nome: "K-404",
                        portraitFilename: "K404.jpg"
                    });

                } catch (err) {
                    console.error("Erro ao carregar dados dos arquivos JSON:", err);
                } finally {
                    setLoading(false);
                }
            };

            useEffect(() => {
                fetchData();
                const nomeLogado = sessionStorage.getItem('active_user') || "Super Estrelado";
                setUsuarioAtivo({ heroName: nomeLogado, portraitFilename: nomeLogado.replace(/\s+/g, '') + ".jpg" });
                const interval = setInterval(fetchData, 10000);
                return () => clearInterval(interval);
            }, []);

            const triggerSecurity = () => setIsBlocked(true);

            const handleProfileClick = (username) => {
                const profile = profiles.find(p => p.usuario === username);
                if (profile) {
                    setSelectedUser(profile);
                    setCurrentView('profile');
                    window.scrollTo(0,0);
                }
            };

            if (loading) return (
                <div className="h-screen flex flex-col items-center justify-center bg-black text-green-500 mono">
                    [ DECRYPTING_SHADOWNET_FEED... ]
                </div>
            );

            return (
                <div className="max-w-[1200px] mx-auto flex min-h-screen border-x border-[#1a1a1a]">
                    
                    {isBlocked && (
                        <div className="security-overlay">
                            <div className="max-w-md text-center border-2 border-red-600 p-8 bg-black shadow-[0_0_50px_rgba(255,0,0,0.3)]">
                                <img src={`./arquivos/k404.jpg}`} className="w-32 h-32 mx-auto mb-4 border-2 border-red-600" onError={(e) => e.target.src='./arquivos/k404.jpg'} />
                                <h2 className="text-red-600 font-bold mono mb-4 uppercase">{securityGuard?.nome || "K-404"}</h2>
                                <p className="text-sm italic text-gray-300 mb-6">
                                    "Calma l√° chocolate quente, t√° querendo entregar nossa localiza√ß√£o? tu s√≥ pode VISUALIZAR! t√° querendo entrar no mundo do crime? Ent√£o aprende a acessar essa porra por conta pr√≥pria e criar uma conta, n√£o usa tuas credenciais de her√≥i para isso, BURRO!!!"
                                </p>
                                <button onClick={() => setIsBlocked(false)} className="bg-red-600 text-white px-6 py-2 mono text-xs hover:bg-red-700">VOLTAR</button>
                            </div>
                        </div>
                    )}

                    <nav className="w-20 md:w-64 flex flex-col p-4 sticky top-0 h-screen bg-black z-20">
                        <div onClick={() => {setCurrentView('feed'); setSelectedUser(null);}} className="mb-10 px-2 text-red-600 font-bold text-4xl mono glitch-hover cursor-pointer">Shadow_Net</div>
                        <div className="space-y-4 flex-1">
                            <NavItem icon="‚ò†" label="TERMINAL" active={currentView === 'feed'} onClick={() => {setCurrentView('feed'); setSelectedUser(null);}} />
                            <NavItem icon="‚ò£" label="ARQUIVOS" onClick={triggerSecurity} />
                            <NavItem icon="‚óà" label="CONTRATOS" onClick={triggerSecurity} />
                            <NavItem icon="‚öô" label="SISTEMA" onClick={triggerSecurity} />
                        </div>
                        <div className="mt-auto p-3 border border-red-900/40 rounded-md bg-red-950/10">
                            <div className="flex items-center gap-3">
                                <div className="w-10 h-10 rounded border border-red-600 bg-cover bg-center" 
                                     style={{ backgroundImage: `url('../FotosDosAgentes/${usuarioAtivo.portraitFilename}')` }}
                                     onError={(e) => e.target.style.backgroundImage = "url('./arquivos/k404.jpg')"}></div>
                                <div className="hidden md:block overflow-hidden">
                                    <p className="text-xs font-bold truncate text-red-500">{usuarioAtivo.heroName}</p>
                                    <p className="text-[10px] text-gray-500 mono">@Acesso_Externo</p>
                                </div>
                            </div>
                        </div>
                    </nav>

                    <main className="flex-1 min-w-0 bg-[#020202]">
                        {currentView === 'feed' ? (
                            <>
                                <header className="p-4 border-b border-[#1a1a1a] backdrop-blur-md sticky top-0 z-10 bg-black/90 flex justify-between items-center">
                                    <h1 className="text-lg font-bold mono tracking-[0.3em] text-green-500">LIVE_FEED</h1>
                                    <span className="text-[10px] text-red-600 animate-pulse">‚óè ENCRYPTED</span>
                                </header>

                                <div className="p-6 border-b border-[#1a1a1a] bg-gradient-to-b from-transparent to-[#080808]">
                                    <div className="flex gap-4">
                                        <div className="w-12 h-12 rounded-sm border border-gray-700 bg-cover bg-center" 
                                             style={{ backgroundImage: `url('../FotosDosAgentes/${usuarioAtivo.portraitFilename}')` }}
                                             onError={(e) => e.target.style.backgroundImage = "url('./arquivos/k404.jpg')"}></div>
                                        <div className="flex-1">
                                            <textarea placeholder="Transmitir mensagem..." className="w-full bg-transparent border-none focus:ring-0 text-lg resize-none placeholder:text-gray-800 mono text-green-100" rows="2"></textarea>
                                            <div className="flex justify-end items-center mt-4 pt-4 border-t border-white/5">
                                                <p className="text-[10px] text-gray-600 mono mr-4">[MODO_OBSERVA√á√ÉO]</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div className="divide-y divide-[#1a1a1a]">
                                    {posts.length > 0 ? posts.map((post, idx) => (
                                        <Post 
                                            key={idx} 
                                            post={post} 
                                            onHashtagClick={triggerSecurity} 
                                            onProfileClick={handleProfileClick}
                                            getProfile={(u) => profiles.find(p => p.usuario === u)} 
                                        />
                                    )) : (
                                        <div className="p-10 text-center mono text-gray-600">NENHUMA TRANSMISS√ÉO ENCONTRADA NO BUFFER.</div>
                                    )}
                                </div>
                            </>
                        ) : (
                            <ProfilePage profile={selectedUser} onBack={() => {setCurrentView('feed'); setSelectedUser(null);}} />
                        )}
                    </main>

                    <aside className="hidden lg:block w-80 p-6 space-y-6 border-l border-[#1a1a1a]">
                        <div className="bg-[#080808] border border-[#1a1a1a] p-5 rounded-sm">
                            <h2 className="font-bold text-sm mb-6 mono text-red-600 border-l-2 border-red-600 pl-2 uppercase">Protocolos</h2>
                            <TrendItem tag="#OperacaoEclipse" posts="DEEP_WEB" onClick={triggerSecurity} />
                            <TrendItem tag="#InfiltracaoUCT" posts="ACTIVE" onClick={triggerSecurity} />
                            <TrendItem tag="#BlackMarket" posts="RESTRICTED" onClick={triggerSecurity} />
                        </div>
                    </aside>
                </div>
            );
        };

        const Post = ({ post, onHashtagClick, onProfileClick, getProfile }) => {
            const owner = getProfile(post.username) || { nome: "Usu√°rio Desconhecido", imagem_perfil: "default.png", usuario: post.username };
            const hashtags = Array.isArray(post.hashtags) ? post.hashtags.filter(h => h && h !== "") : [];

            const getImgSrc = (img) => {
                if(!img) return './arquivos/k404.jpg';
                if(img.startsWith('http')) return img;
                return `./arquivos/${img}`;
            };

            // L√≥gica para extrair respostas dinamicamente do JSON
            const replies = [];
            Object.keys(post).forEach(key => {
                if (key.startsWith('reposta')) { // Nota: Seguindo o erro de digita√ß√£o 'reposta' do seu JSON
                    const num = key.replace('reposta', '');
                    const textoResp = post[key];
                    const donoResp = post[`donoResposta${num}`];
                    
                    if (textoResp && textoResp.trim() !== "") {
                        replies.push({
                            texto: textoResp,
                            username: donoResp
                        });
                    }
                }
            });

            return (
                <div className="flex flex-col">
                    <article className="post-card p-6 flex gap-4 bg-black/20">
                        <img 
                            src={getImgSrc(owner.imagem_perfil)} 
                            className="w-12 h-12 rounded border border-white/5 cursor-pointer hover:opacity-80 transition-opacity object-cover" 
                            onClick={() => onProfileClick(post.username)}
                            onError={(e) => e.target.src='./arquivos/k404.jpg'}
                        />
                        <div className="flex-1 min-w-0">
                            <div className="flex items-center gap-2 mb-2">
                                <span 
                                    className="font-bold text-sm neon-user-name cursor-pointer hover:underline"
                                    onClick={() => onProfileClick(post.username)}
                                >
                                    {owner.nome}
                                </span>
                                <span className="text-gray-600 text-[10px] mono">@{post.username.replace('@', '')}</span>
                                <span className="text-gray-700 text-[10px] mono ml-auto">// {post.createdAt}</span>
                            </div>
                            <p className="text-sm leading-relaxed mb-4 text-gray-400 mono">
                                {post.content}
                                <br/>
                                {hashtags.map((tag, i) => (
                                    <span key={i} onClick={onHashtagClick} className="text-green-500 cursor-pointer hover:underline mr-2">{tag}</span>
                                ))}
                            </p>
                            
                            {post.media && post.media !== "" && (
                                <div className="mt-3 rounded-lg overflow-hidden border border-[#1a1a1a]">
                                    {post.type === 'image' ? (
                                        <img src={`./arquivos/${post.media}`} className="w-full max-h-96 object-cover" />
                                    ) : post.type === 'video' ? (
                                        <video src={`./arquivos/${post.media}`} controls className="w-full" />
                                    ) : null}
                                </div>
                            )}

                            <div className="flex gap-6 mt-4 text-gray-600 mono text-[11px]">
                                <span>REPLIES: {post.replies || 0}</span>
                                <span>RETWEETS: {post.retweets || 0}</span>
                                <span>LIKES: {post.likes || 0}</span>
                            </div>
                        </div>
                    </article>

                    {/* Renderiza√ß√£o das Respostas */}
                    {replies.map((rep, i) => {
                        const repOwner = getProfile(rep.username) || { nome: "Usu√°rio Desconhecido", imagem_perfil: "default.png", usuario: rep.username };
                        return (
                            <div key={i} className="reply-card p-4 flex gap-3 mb-2">
                                <img 
                                    src={getImgSrc('./arquivos/k404.jpg')} 
                                    className="w-8 h-8 rounded border border-white/5 cursor-pointer object-cover"
                                    onClick={() => onProfileClick(rep.username)}
                                    onError={(e) => e.target.src='./arquivos/k404.jpg'}
                                />
                                <div className="flex-1 min-w-0">
                                    <div className="flex items-center gap-2 mb-1">
                                        <span className="font-bold text-xs text-red-500">{repOwner.nome}</span>
                                        <span className="text-gray-600 text-[9px] mono">@{rep.username?.replace('@', '')}</span>
                                    </div>
                                    <p className="text-xs text-gray-400 mono">{rep.texto}</p>
                                </div>
                            </div>
                        );
                    })}
                </div>
            );
        };

        const ProfilePage = ({ profile, onBack }) => {
            if (!profile) return null;
            const audioRef = useRef(null);

            useEffect(() => {
                if (profile.musicaDeFundo && profile.musicaDeFundo !== "") {
                    const audioPath = `./arquivos/${profile.musicaDeFundo}`;
                    audioRef.current = new Audio(audioPath);
                    audioRef.current.loop = true;
                    const playPromise = audioRef.current.play();
                    if (playPromise !== undefined) {
                        playPromise.catch(error => console.log("Audio block:", error));
                    }
                }
                return () => {
                    if (audioRef.current) {
                        audioRef.current.pause();
                        audioRef.current = null;
                    }
                };
            }, [profile]);

            const getImgSrc = (img) => {
                if(!img) return './arquivos/k404.jpg';
                if(img.startsWith('http')) return img;
                return `./arquivos/${img}`;
            };

            return (
                <div className="animate-in fade-in duration-500">
                    <div className="p-4 border-b border-[#1a1a1a] flex items-center gap-6 sticky top-0 bg-black/90 z-10">
                        <button onClick={onBack} className="text-green-500 hover:text-white mono">{"< VOLTAR"}</button>
                        <div>
                            <h1 className="font-bold text-xl uppercase tracking-tighter neon-user-name">{profile.nome}</h1>
                            <p className="text-[10px] text-gray-500 mono">{profile.tweets} TRANSMISS√ïES DETECTADAS</p>
                        </div>
                    </div>

                    <div className="relative">
                        <div 
                            className="h-48 bg-zinc-900 bg-cover bg-center border-b border-[#1a1a1a]"
                            style={{ 
                                backgroundImage: (profile.imagem_capa && profile.imagem_capa !== "") 
                                    ? `url('./arquivos/${profile.imagem_capa}')` 
                                    : 'none' 
                            }}
                        ></div>
                        <div className="px-6 -mt-16 mb-4 flex justify-between items-end">
                            <img 
                                src={getImgSrc(profile.imagem_perfil)} 
                                className="w-32 h-32 rounded-sm border-4 border-black bg-black object-cover"
                                onError={(e) => e.target.src='./arquivos/k404.jpg'}
                            />
                            {profile.verificado && (
                                <span className="bg-green-500 text-black px-2 py-1 text-[10px] font-bold mono mb-2">VERIFICADO_SDN</span>
                            )}
                        </div>
                    </div>

                    <div className="p-6 space-y-4">
                        <div>
                            <h2 className="text-2xl font-bold neon-user-name">{profile.nome}</h2>
                            <p className="text-gray-500 mono">{profile.usuario}</p>
                        </div>
                        <p className="text-gray-300 leading-relaxed italic border-l-2 border-green-500 pl-4">
                            "{profile.bio || "Sem descri√ß√£o dispon√≠vel..."}"
                        </p>
                        <div className="flex flex-wrap gap-4 text-xs text-gray-500 mono">
                            {profile.localizacao && <span>üìç {profile.localizacao}</span>}
                            <span>üìÖ INGRESSOU EM: {profile.data_criacao}</span>
                        </div>
                        <div className="flex gap-6 pt-4 border-t border-[#1a1a1a] mono text-sm">
                            <p><span className="text-white font-bold">{profile.seguindo}</span> <span className="text-gray-600">SEGUINDO</span></p>
                            <p><span className="text-white font-bold">{profile.seguidores}</span> <span className="text-gray-600">SEGUIDORES</span></p>
                        </div>
                    </div>
                </div>
            );
        };

        const NavItem = ({ icon, label, active, onClick }) => (
            <div onClick={onClick} className={`flex items-center gap-5 p-3 rounded cursor-pointer transition-all ${active ? 'bg-green-500/5 text-green-500 border-r-2 border-green-500' : 'text-gray-500 hover:text-white hover:bg-white/5'}`}>
                <span className="text-xl">{icon}</span>
                <span className="hidden md:block font-bold text-xs mono tracking-widest">{label}</span>
            </div>
        );

        const TrendItem = ({ tag, posts, onClick }) => (
            <div className="py-3 border-b border-white/5 last:border-0 cursor-pointer group" onClick={onClick}>
                <p className="text-red-900 text-[9px] mono mb-1">[STATUS: {posts}]</p>
                <p className="font-bold text-xs text-gray-400 group-hover:text-green-500 transition-colors">{tag}</p>
            </div>
        );

        const root = ReactDOM.createRoot(document.getElementById("root"));
        root.render(<App />);
    </script>
</body>
</html>